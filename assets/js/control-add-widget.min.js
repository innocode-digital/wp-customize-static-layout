!function(u,t,h,n,o){"use strict";var g=t.customize;g.controlConstructor[n.type]=g.Control.extend({getWidgetIndexes:function(){var t=h.keys(this.setting());return t.length?h.filter(h.map(t,function(t){return parseInt(t,10)}),function(t){return!isNaN(t)}).sort():[]},getLastWidgetIndex:function(){return this.getWidgetIndexes().length?h.max(this.getWidgetIndexes()):-1},getParentContainer:function(){var t=g.section(this.section());return t.contentContainer.is("ul")?t.contentContainer:t.contentContainer.find("ul:first")},addWidget:function(){var d=this.setting.id,t=h.clone(g.section(d).params),e=t.id+"["+this.index+"]";return h.forEach(g.section(d).controls(),function(s){s=this.addControl(e,s),g(s.id).bind(function(t,e){var n=g(d),i=n.get(),o=h.clone(i);h.isArray(o)||(o=[]),h.isObject(o[t])||(o[t]={}),o[t][s.name]=e,n.set(o),n.callbacks.fireWith(n,[o,i])}.bind(this,this.index))}.bind(this)),delete t.id,delete t.instanceNumber,t.title+=" #"+(this.index+1),g.section.add(new g.OuterSection(e,t)),this.addEditButton(e),this.index+=1,e},addControl:function(t,e){var n=this.setting(),i=h.extend({},e.params,{section:t}),o=i.settings.default,s=o.replace(/([^[]+\[\d+]\[[^\[]+])(\[\w+])$/g,"$1["+this.index+"]$2"),d=o.replace(/[^[]+\[\d+]\[[^\[]+]\[(\w+)]$/g,"$1"),r=h.clone(g.settings.settings[o]),a="",c={},l=g.controlConstructor[i.type]||g.Control;return delete r.value,h.has(n,this.index)&&h.has(n[this.index],d)&&(a=n[this.index][d]),g.add(new g.Setting(s,a,r)),h.contains(["select","dropdown-pages"],i.type)&&(u(i.content).find("option").each(function(t,e){var n=u(e);c[n.attr("value")]=n.html()}),i.type="select"),"radio"===i.type&&u(i.content).find('[type="radio"]').each(function(t,e){var n=u(e);c[n.attr("value")]=n.next("label").html()}),h.isEmpty(c)||(i.choices=c),delete i.content,delete i.settings,delete i.instanceNumber,i.setting=s,g.control.add(new l(s,i)),{id:s,name:d}},addEditButton:function(t){var e="_"+this.setting.id,n=h.extend({},g.control(e).params,{active:!0}),i=h.clone(g.settings.settings[e]);return delete i.value,g.add(new g.Setting(t,null,i)),delete n.content,delete n.settings,delete n.instanceNumber,n.setting=t,g.control.add(new g.controlConstructor[o.type](t,n)),t},initializeSortable:function(){var t=this.getParentContainer();return t.sortable({handle:"."+n.namespace+"-sort-widget-button",items:"> li.customize-control-"+n.namespace+"_edit_widget",cancel:"input,textarea,button:not(."+n.namespace+"-sort-widget-button),select,option",stop:this._onSort.bind(this)}),t.disableSelection(),this},_onClick:function(t){return t.preventDefault(),g.section(this.addWidget()).expand(),this},_onSort:function(){var t=this.getParentContainer(),i=t.find("> li.customize-control-"+n.namespace+"_edit_widget").filter(":visible"),e=h.filter(g.section(this.section()).controls(),function(t){return 0===t.id.lastIndexOf(this.id+"[",0)}.bind(this)),o={};return h.forEach(e,function(t){h.reduce(g.section(t.id).controls(),function(t,e){return t[e.id]=g(e.id).get(),t},o)}),h.forEach(e,function(t){var e=i.index(t.container),n=g.section(t.id);n.expanded()&&n.collapse(),h.forEach(n.controls(),function(t){g(t.id.replace(/([^[]+\[\d+]\[[^\[]+])\[\d+](\[\w+])$/g,"$1["+e+"]$2")).set(o[t.id])})}),t.sortable("cancel"),this},ready:function(){return this.index=0,h.defer(function(){var t,e=this.getLastWidgetIndex();-1<e&&(t=this.addWidget.bind(this),h.forEach(h.range(e+1),t)),this.initializeSortable()}.bind(this)),this.container.find(".button").on("click",this._onClick.bind(this)),this}})}(jQuery,window.wp,_,window.customizeStaticLayoutControlAddWidget,window.customizeStaticLayoutControlEditWidget);