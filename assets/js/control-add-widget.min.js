!function(a,t,c,o,i){"use strict";var l=t.customize;l.controlConstructor[o.type]=l.Control.extend({getWidgetIndexes:function(){var t=c.keys(this.setting());return t.length?c.filter(c.map(t,function(t){return parseInt(t,10)}),function(t){return!isNaN(t)}).sort():[]},getLastWidgetIndex:function(){return this.getWidgetIndexes().length?c.max(this.getWidgetIndexes()):-1},getParentContainer:function(){var t=l.section(this.section());return t.contentContainer.is("ul")?t.contentContainer:t.contentContainer.find("ul:first")},addWidget:function(){var d=this.setting.id,t=c.clone(l.section(d).params),e=t.id+"["+this.index+"]";return c.forEach(l.section(d).controls(),function(s){s=this.addControl(e,s),l(s.id).bind(function(t,e){var n=l(d),i=n.get(),o=c.clone(i);c.isArray(o)||(o=[]),c.isObject(o[t])||(o[t]={}),o[t][s.name]=e,n.set(o),n.callbacks.fireWith(n,[o,i])}.bind(this,this.index))}.bind(this)),delete t.id,delete t.instanceNumber,t.title+=" #"+(this.index+1),l.section.add(new l.OuterSection(e,t)),this.addEditButton(e),this.index+=1,e},addControl:function(t,e){var n=this.setting(),i=c.extend({},e.params,{section:t}),o=i.settings.default,s=o.replace(/([^[]+\[\d+]\[[^\[]+])(\[\w+])$/g,"$1["+this.index+"]$2"),d=o.replace(/[^[]+\[\d+]\[[^\[]+]\[(\w+)]$/g,"$1"),e=c.clone(l.settings.settings[o]),t="",r={},o=l.controlConstructor[i.type]||l.Control;return delete e.value,c.has(n,this.index)&&c.has(n[this.index],d)&&(t=n[this.index][d]),l.add(new l.Setting(s,t,e)),c.contains(["select","dropdown-pages"],i.type)&&(a(i.content).find("option").each(function(t,e){e=a(e);r[e.attr("value")]=e.html()}),i.type="select"),"radio"===i.type&&a(i.content).find('[type="radio"]').each(function(t,e){e=a(e);r[e.attr("value")]=e.next("label").html()}),c.isEmpty(r)||(i.choices=r),delete i.content,delete i.settings,delete i.instanceNumber,i.setting=s,l.control.add(new o(s,i)),{id:s,name:d}},addEditButton:function(t){var e="_"+this.setting.id,n=c.extend({},l.control(e).params,{active:!0}),e=c.clone(l.settings.settings[e]);return delete e.value,l.add(new l.Setting(t,null,e)),delete n.content,delete n.settings,delete n.instanceNumber,n.setting=t,l.control.add(new l.controlConstructor[i.type](t,n)),t},initializeSortable:function(){var t=this.getParentContainer();return t.sortable({handle:"."+o.namespace+"-sort-widget-button",items:"> li.customize-control-"+o.namespace+"_edit_widget",cancel:"input,textarea,button:not(."+o.namespace+"-sort-widget-button),select,option",stop:this._onSort.bind(this)}),t.disableSelection(),this},_onClick:function(t){return t.preventDefault(),l.section(this.addWidget()).expand(),this},_onSort:function(){var t=this.getParentContainer(),n=t.find("> li.customize-control-"+o.namespace+"_edit_widget").filter(":visible"),e=c.filter(l.section(this.section()).controls(),function(t){return 0===t.id.lastIndexOf(this.id+"[",0)}.bind(this)),i={};return c.forEach(e,function(t){c.reduce(l.section(t.id).controls(),function(t,e){return t[e.id]=l(e.id).get(),t},i)}),c.forEach(e,function(t){var e=n.index(t.container),t=l.section(t.id);t.expanded()&&t.collapse(),c.forEach(t.controls(),function(t){l(t.id.replace(/([^[]+\[\d+]\[[^\[]+])\[\d+](\[\w+])$/g,"$1["+e+"]$2")).set(i[t.id])})}),t.sortable("cancel"),this},ready:function(){return this.index=0,c.defer(function(){var t,e=this.getLastWidgetIndex();-1<e&&(t=this.addWidget.bind(this),c.forEach(c.range(e+1),t)),this.initializeSortable()}.bind(this)),this.container.find(".button").on("click",this._onClick.bind(this)),this}})}(jQuery,window.wp,_,window.customizeStaticLayoutControlAddWidget,window.customizeStaticLayoutControlEditWidget);