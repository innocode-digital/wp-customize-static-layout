!function(t,i,e,n){"use strict";var o=i.customize;o.controlConstructor[n.type]=o.Control.extend({getBaseId:function(){return this.setting.id.replace(/([^[]+\[\d+]\[[^\[]+])\[\d+]$/g,"$1")},getIndexById:function(t){return parseInt(t.replace(/[^[]+\[\d+]\[[^\[]+]\[(\d+)]$/g,"$1"),10)},getIndex:function(){return this.getIndexById(this.setting.id)},getNameById:function(t){return t.replace(/[^[]+\[\d+]\[[^\[]+]\[\d+]\[(\w+)]$/g,"$1")},removeWidget:function(){var t=o.section(this.setting.id),i=this.getBaseId(),n=this.getIndex(),s=o.section(this.section()),c=[],d=e.filter(s.controls(),function(t){return 0===t.id.lastIndexOf(i+"[",0)}),r=e.last(d);return t.collapse(),e.forEach(e.filter(d,function(t){var i=this.getIndexById(t.id);return!isNaN(i)&&i>n&&(c.push(i),!0)}.bind(this)),function(t,n){var s=o.section(t.id);e.forEach(s.controls(),function(t){o(i+"["+(c[n]-1)+"]["+this.getNameById(t.id)+"]").set(o(t.id).get())}.bind(this))}.bind(this)),e.forEach(o.section(r.id).controls(),function(t){o.remove(t.id),o.control(t.id).container.remove(),o.control.remove(t.id)}),o.remove(r.id),o.control(r.id).container.remove(),o.control.remove(r.id),o.section(r.id).container.remove(),o.section.remove(r.id),this.removeFromBase(i),this},removeFromBase:function(t,i){var n=o(t),s=n.get(),c=e.clone(s);return c.pop(),n.set(c),n.callbacks.fireWith(n,[c,s]),o.control(t).index-=1,s[i]},deactivateAllButtons:function(){return this.container.siblings("."+this.container[0].className.split(/\s+/).join(".")).find("."+n.namespace+"-edit-widget-button").removeClass("active"),this},maybeToggleDuplication:function(){return this.container.find("."+n.namespace+"-duplicate-widget-button").prop("disabled",e.isEmpty(e.filter(o(this.getBaseId()).get()[this.getIndex()]))),this},_onClick:function(t){return t.preventDefault(),o.section(this.setting.id).expand(),this},_onDuplicateClick:function(t){t.preventDefault();var i=this.getBaseId(),n=o.control(i).addWidget();o.section(this.setting.id);return e.forEach(o.section(this.setting.id).controls(),function(t){o(n+"["+this.getNameById(t.id)+"]").set(o(t.id).get())}.bind(this)),o.section(n).expand(),this},_onRemoveClick:function(t){return t.preventDefault(),confirm(this.params.l10n.confirmRemove)&&(this.deactivateAllButtons(),this.removeWidget()),this},_onExpanded:function(){return this.container.find("."+n.namespace+"-edit-widget-button").addClass("active"),this.deactivateAllButtons(),this},_onCollapsed:function(){return this.container.find("."+n.namespace+"-edit-widget-button").removeClass("active"),this},ready:function(){var t,i=o.section(this.setting.id);return this.container.find("."+n.namespace+"-edit-widget-button").on("click",this._onClick.bind(this)),this.container.find("."+n.namespace+"-duplicate-widget-button").on("click",this._onDuplicateClick.bind(this)),this.container.find("."+n.namespace+"-remove-widget-button").on("click",this._onRemoveClick.bind(this)),i&&((t=o.section(this.setting.id).container).on("expanded",this._onExpanded.bind(this)),t.on("collapsed",this._onCollapsed.bind(this)),this.maybeToggleDuplication(),e.forEach(o.section(this.setting.id).controls(),function(t){o(t.id).bind(this.maybeToggleDuplication.bind(this))}.bind(this))),this}})}(jQuery,window.wp,_,window.customizeStaticLayoutControlEditWidget);