!function(t,i,d,e){"use strict";var r=i.customize;r.controlConstructor[e.type]=r.Control.extend({getBaseId:function(){return this.setting.id.replace(/([^[]+\[\d+]\[[^\[]+])\[\d+]$/g,"$1")},getIndexById:function(t){return parseInt(t.replace(/[^[]+\[\d+]\[[^\[]+]\[(\d+)]$/g,"$1"),10)},getIndex:function(){return this.getIndexById(this.setting.id)},getNameById:function(t){return t.replace(/[^[]+\[\d+]\[[^\[]+]\[\d+]\[(\w+)]$/g,"$1")},removeWidget:function(){var t=r.section(this.setting.id),n=this.getBaseId(),e=this.getIndex(),i=r.section(this.section()),o=[],s=d.filter(i.controls(),function(t){return 0===t.id.lastIndexOf(n+"[",0)}),c=d.last(s);return t.collapse(),d.forEach(d.filter(s,function(t){var i=this.getIndexById(t.id);return!isNaN(i)&&e<i&&(o.push(i),!0)}.bind(this)),function(t,i){var e=r.section(t.id);d.forEach(e.controls(),function(t){r(n+"["+(o[i]-1)+"]["+this.getNameById(t.id)+"]").set(r(t.id).get())}.bind(this))}.bind(this)),d.forEach(r.section(c.id).controls(),function(t){r.remove(t.id),r.control(t.id).container.remove(),r.control.remove(t.id)}),r.remove(c.id),r.control(c.id).container.remove(),r.control.remove(c.id),r.section(c.id).container.remove(),r.section.remove(c.id),this.removeFromBase(n),this},removeFromBase:function(t,i){var e=r(t),n=e.get(),o=d.clone(n);return o.pop(),e.set(o),e.callbacks.fireWith(e,[o,n]),r.control(t).index-=1,n[i]},deactivateAllButtons:function(){return this.container.siblings("."+this.container[0].className.split(/\s+/).join(".")).find("."+e.namespace+"-edit-widget-button").removeClass("active"),this},maybeToggleDuplication:function(){return this.container.find("."+e.namespace+"-duplicate-widget-button").prop("disabled",d.isEmpty(d.filter(r(this.getBaseId()).get()[this.getIndex()]))),this},_onClick:function(t){return t.preventDefault(),r.section(this.setting.id).expand(),this},_onDuplicateClick:function(t){t.preventDefault();var i=this.getBaseId(),e=r.control(i).addWidget();return d.forEach(r.section(this.setting.id).controls(),function(t){r(e+"["+this.getNameById(t.id)+"]").set(r(t.id).get())}.bind(this)),r.section(e).expand(),this},_onRemoveClick:function(t){return t.preventDefault(),confirm(this.params.l10n.confirmRemove)&&(this.deactivateAllButtons(),this.removeWidget()),this},_onExpanded:function(){return this.container.find("."+e.namespace+"-edit-widget-button").addClass("active"),this.deactivateAllButtons(),this},_onCollapsed:function(){return this.container.find("."+e.namespace+"-edit-widget-button").removeClass("active"),this},ready:function(){var t,i=r.section(this.setting.id);return this.container.find("."+e.namespace+"-edit-widget-button").on("click",this._onClick.bind(this)),this.container.find("."+e.namespace+"-duplicate-widget-button").on("click",this._onDuplicateClick.bind(this)),this.container.find("."+e.namespace+"-remove-widget-button").on("click",this._onRemoveClick.bind(this)),i&&((t=r.section(this.setting.id).container).on("expanded",this._onExpanded.bind(this)),t.on("collapsed",this._onCollapsed.bind(this)),this.maybeToggleDuplication(),d.forEach(r.section(this.setting.id).controls(),function(t){r(t.id).bind(this.maybeToggleDuplication.bind(this))}.bind(this))),this}})}(jQuery,window.wp,_,window.customizeStaticLayoutControlEditWidget);